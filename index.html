<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CRUD de productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
    <h2>Gesti√≥n de Productos</h2>
    

  <!-- Formulario para agregar producto -->
  
  <form id="formAgregar">
    
   <p> Nombre del producto: <input class="col-sm-6" type="text" id="name" placeholder="Escribe el nombre de un producto" ></p>
   <p> Precio: <input class ="col-sm-6"type="number" step="0.01" id="price" placeholder="Escribe su precio"><br></p>
    <p>Stock: <input class="col-sm-6" type="number" id="stock" placeholder="Escribe el stock"><br></p>
    <button type="submit" class="btn btn-success">Agregar</button>
  </form>
  
  <div id="resultadoError"></div>

    <!--Buscador-->
  <h2>Buscar por Id</h2>
  <form id="formBuscar">
    ID: <input type="number" id="buscarId">
     <button type="submit" class="btn btn-primary">Buscar</button>
  </form>
  <div id="resultadoBusqueda">

  <!-- Tabla para mostrar productos -->
  <h2>Lista de Productos</h2>
  <table border="1" id="tablaProductos" class="table">
    <thead class="thead-dark">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Nombre</th>
        <th scope="col">Precio</th>
        <th scope="col">Stock</th>
        <th scope="col">Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <script>
    const API_URL="http://localhost:8000/products"; 
    //Cargar productos
    async function cargarProductos(){
        const res=await fetch(API_URL);
        const productos = await res.json(); 
        const tbody=document.querySelector("#tablaProductos tbody")
        tbody.innerHTML=""; 
        productos.forEach(p=>{
            const fila = `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>${p.price}</td>
                    <td>${p.stock}</td>
                    <td>
                        <button onClick="eliminarProducto(${p.id})" class="btn btn-danger">Eliminar</button>
                        <button onClick="editarProducto(${p.id},'${p.name}', ${p.price}, ${p.stock})" class="btn btn-warning">Editar</button>
                    </td>
                </tr>`;
            tbody.innerHTML += fila; 
        }); 
    }

    async function eliminarProducto(id){
        await fetch(`${API_URL}/${id}`, {method:"DELETE"}); 
        cargarProductos(); 
    }

    cargarProductos(); 

    //Editar
    function editarProducto(id, name, price, stock){
        document.getElementById("name").value=name;
        document.getElementById("price").value=price; 
        document.getElementById("stock").value=stock; 

        let editMode=false; 
        let editId=null;

        //Cambiar el comportamiento del formulario
        const form=document.getElementById("formAgregar"); 
        const boton= form.querySelector("button"); 

        //Cambiar de boton 
        boton.textContent="Confirmar edicion"; 

        form.onsubmit=async e =>{
            e.preventDefault(); 
            const data={
                name: document.getElementById("name").value, 
                price:parseFloat(document.getElementById("price").value),
                stock:parseInt(document.getElementById("stock").value)
            }; 

            await fetch(`${API_URL}/${id}`,{
                method: "PUT", 
                headers:{"Content-Type": "application/json"}, 
                body: JSON.stringify(data)
            }); 
            cargarProductos();

            //Restaurar el formulario despues de editar
            form.onsubmit = agregarProducto; 
            boton.textContent="Agregar"; 
            form.reset(); 
        }; 
    }

    //Agregar productos
    async function agregarProducto(e){
        e.preventDefault(); 
        const data = {
            name: document.getElementById("name").value, 
            price: parseFloat(document.getElementById("price").value), 
            stock: parseInt(document.getElementById("stock").value)
        }; 

        const res=await fetch(API_URL, {
            method:"POST", 
            headers: {"Content-Type": "appication/json"}, 
            body:JSON.stringify(data)
        }); 

        const resultado= await res.json(); 
        const div = document.getElementById("resultadoError"); 

        if (!res.ok){
            div.innerHTML=`<pstyle="color:red;">${resultado.error}</p>`;
        } 
            else{
                div.innerHTML="";
                cargarProductos(); 
                document.getElementById("formAgregar").reset(); 
            }
    }

    document.getElementById("formAgregar").onsubmit=agregarProducto; 

    //Buscar por ID
    document.getElementById("formBuscar").addEventListener("submit", async e =>{
        e.preventDefault(); 
        const id = document.getElementById("buscarId").value; 
        const res = await fetch(`${API_URL}/${id}`); 
        const producto=await res.json(); 
        const div = document.getElementById("resultadoBusqueda"); 

        if (producto.error){
            div.innerHTML=`<p style ="color:red;">${producto.error}</p>`; 
        } else {
            div.innerHTML=`
            <p><strong>ID:</strong>${producto.id}</p>
            <p><stong>Nombre:</strong>${producto.name}</p>
            <p><strong>Precio:</strong>${producto.price}</p>
            <p><strong>Stock:</strong>${producto.stock}</p>
            `;
        }
    }); 
  </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</body>
</html>
